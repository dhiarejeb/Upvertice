<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Manage Supplier Offers</h2>
    <button class="btn btn-primary" (click)="openCreateForm()">
      <i class="fa fa-plus"></i> New Offer
    </button>
  </div>

  <!-- Offers Card Grid -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let offer of supplierOffers">
      <div class="card h-100 shadow-sm">
        <img
          *ngIf="offer.imageUrl"
          [src]="offer.imageUrl"
          class="card-img-top"
          alt="Offer Image"
          style="object-fit: cover; height: 200px"
        />
        <div class="card-body">
          <h5 class="card-title">{{ offer.title }}</h5>
          <p class="card-text text-muted">{{ offer.description }}</p>
          <p class="mb-1">
            <i class="fa fa-calendar"></i>
            {{ offer.startDate }} â†’ {{ offer.endDate }}
          </p>
          <p class="mb-1">
            <i class="fa fa-tag"></i> {{ offer.price }} TND
          </p>
          <p class="mb-1">
            <i class="fa fa-box"></i> Quantity: {{ offer.quantityAvailable }}
          </p>
          <p>
            <span class="badge bg-info text-dark">{{ offer.status }}</span>
          </p>

          <div *ngIf="offer.sponsorAds?.length; else noAds">
            <p class="fw-bold mb-1">Sponsor Ads:</p>
            <div class="d-flex flex-wrap gap-3">
              <div *ngFor="let ad of offer.sponsorAds" class="text-center" style="max-width: 120px;">
                <!-- Larger thumbnail -->
                <img
                  *ngIf="ad.design"
                  [src]="ad.design"
                  alt="{{ ad.title }}"
                  class="img-thumbnail mb-1"
                  style="width: 120px; height: 120px; object-fit: cover;"
                />
                <!-- Full title, wrapping if needed -->
                <div class="small text-wrap">
                  {{ ad.title }}
                </div>
              </div>
            </div>
          </div>
          <ng-template #noAds>
            <p class="text-muted">No Sponsor Ads</p>
          </ng-template>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-sm btn-warning" (click)="editOffer(offer)">
            <i class="fa fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="confirmDelete(offer.id!)">
            <i class="fa fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>



  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 0">
        <a class="page-link" (click)="changePage(-1)">Previous</a>
      </li>

      <li
        class="page-item"
        *ngFor="let i of [].constructor(totalPages); let index = index"
        [class.active]="index === currentPage">
        <a class="page-link" (click)="changePage(index - currentPage)">{{ index + 1 }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage + 1 >= totalPages">
        <a class="page-link" (click)="changePage(1)">Next</a>
      </li>
    </ul>
  </nav>


  <!-- Create/Update Modal -->
  <div *ngIf="formVisible" class="modal show d-block" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title">{{ editing ? 'Edit Offer' : 'Create Offer' }}</h5>
          <button type="button" class="btn-close" (click)="closeForm()"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="onSubmit()" [formGroup]="offerForm">
            <div class="row g-2">
              <div class="col-md-6">
                <label>Title</label>
                <input formControlName="title" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label>Price (TND)</label>
                <input type="number" formControlName="price" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label>Quantity</label>
                <input type="number" formControlName="quantityAvailable" class="form-control" required>
              </div>
              <div class="col-md-6">
                <label>Status</label>
                <select formControlName="status" class="form-select">
                  <option value="COMING_SOON">Coming Soon</option>
                  <option value="AVAILABLE">Available</option>
                  <option value="CLOSED">Closed</option>
                </select>
              </div>
              <div class="col-md-6">
                <label>Start Date</label>
                <input type="date" formControlName="startDate" class="form-control">
              </div>
              <div class="col-md-6">
                <label>End Date</label>
                <input type="date" formControlName="endDate" class="form-control">
              </div>
              <div class="col-12">
                <label>Description</label>
                <textarea formControlName="description" class="form-control"></textarea>
              </div>
              <div class="form-group">
                <label for="sponsorAdIds">Sponsor Ad IDs</label>
                <input
                  type="text"
                  id="sponsorAdIds"
                  class="form-control"
                  placeholder="Enter Sponsor Ad IDs (comma-separated)"
                  formControlName="sponsorAdIds"
                />
              </div>
              <div class="col-12">
                <label>Image</label>
                <input type="file" (change)="onImageSelected($event)" class="form-control">
              </div>
            </div>
            <div class="text-end mt-3">
              <button type="submit" class="btn btn-success">
                <i class="fa fa-save"></i> {{ editing ? 'Update' : 'Create' }}
              </button>
              <button type="button" class="btn btn-secondary ms-2" (click)="closeForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
